<HTML>
<HEADER>
<TITLE>Locating waters in HSP90 binding cavity</TITLE>
</HEADER>
<BODY>
<H1>Locating waters in HSP90 binding cavity</H1>
In this tutorial, you will estimate the possition of the waters in the binding cavity of N-terminal domain of HSP90 with a small fragment bound. To acchieve this we will use the JAWS<sup>1</sup> technique.
<H3>Prerequisites</H3>
<ul>
	<li><code>fragment.pdb</code> - the structure of the small fragment molecule in PDB format</li>
	<li><code>protein.pdb</code> - the structure of the N-terminal domain of HSP90 in PDB format</li>
</ul>
Both the fragment and protein need to be prepared before they are used with ProtoMS. For instance, you must make sure that they are protonated. You can read more about setting up structures here.
<p>
<hr align="center"/>
<h3>Simple setup</h3>
<h5>Setup</h5>
The simplest way to setup the simulation is by typing the following
</p>
<p>
<code>python2.7 $PROTOMSHOME/protoms.py -s jaws1 -p protein.pdb -l fragment.pdb </code>
</p>
this sets up one JAWS stage 1 simulation, to locate the waters which can be placed 2 A around your ligand.<p> The simulations will run 5 m equilibration steps and 40 m production steps. Output will be printed to files every 100 k moves.
<p>
the <code>-s jaws1</code> argument tells the script to setup a JAWS stage 1 simulation. The <code>-p</code> and <code>-l</code> arguments specifies the protein and the ligand, respectively.
</p> 
You can read more about the files that the setup script creates further down on this <a href="#files">page</a>.
<p>You can visualise the systems that will be simulated with for instance VMD:
<pre>vmd -m protein.pdb fragment.pdb water_clr.pdb jaws1_wat.pdb
<p>
<img src="setup.png"  alt="" />
</p>
</p>
<p> 
<h5>Execution</h5>
To run the simulation you need to execute
<p>
<code>$PROTOMSHOME/protoms3 run_bnd.cmd</code>
<p>
The calculations will take approximately 10 h to complete.
<p>
<h5>Analysis</h5>
When the simulations are finished you need to analyse the simulation and conclude on a location for the waters in the binding site. We shold start by separating the global pdb of your simulation into individual snapshots. Go to the directory called out and run:
<pre>
python2.7 $PROTOMSHOME/tools/divide_pdb.py
</pre>
and then, to visualize the positions of the waters at one given point in the simultion, for example, at the middle of your production run, type:
<pre>
vmd snapshot_200.pdb
</pre>
and try to see if there was any water in the binding site (the residue name of your jaws waters is "WAT"). Remember that, which ever jaws waters you may find, are the "on" &mdash; fully interacting &mdash; waters (with &#952; > 0.95, where &#952; corresponds to the scaling of their interactions).
But looking at each snapshot individually is hard to get a whole picture of where your waters were distributed throughout the simulation. To get a more visual picture of this we produce and visualize a water density file. To generate such a file run:
<pre>
python2.7 $PROTOMSHOME/tools/calc_density.py -f all.pdb
</pre>
and the file grid.dx will be produced. Such a file can be visualized in vmd. Try looking at it with:
<pre>
vmd -m grid.dx ../protein.pdb ../fragment.pdb
</pre>
<p>
You should be looking at something similar to this (after fiddling a bit with the graphical representation options in VMD):
</p>
<img src="density.png"  alt="" />
<p>
A different visualization option are the clusters. These can be generated going to your out folder and using the following command</p>
<code>
python2.7 $PROTOMSHOME/tools/calc_clusters.py -f all.pdb -m WAT
</code>
and then visualized with
<code>
vmd -m clusters.pdb ../protein.pdb ../fragment.pdb
</code>
<p>
You should be looking at something similar to the image below, after tweaking the graphical representation options in VMD. It is probably interesting to display only the most populated clusters by showing only <code> resid 1 to 5 </code>, for example, since clusters are assigned residue id in order of most populated clusters.
</p>
<img src="cluster.png"  alt="" />
<p> 
<h3>Exploring more options</h3>
<p>
<h5>Running JAWS on different areas of your simulation</h5>
By running <code>protoms.py</code> as above, protoms will try to locate the waters found in a box with edges at least 2A away from any of your ligand atoms. However, you may wish to find the location of waters in any area of your simulation (though normally it will include your binding site).
</p>
<p>
You can define any desired area (in box shape) of your simulation to run JAWS on, by specifying the box origin and dimentions with the flag <code>--gcmcbox</code>, such as it is done below
<p><code>
python2.7 ~/ProtoMS3.0/protoms.py -l fragment.pdb -p protein.pdb -s jaws1 -c big --gcmcbox 59 31 23 8 8 8
</code></p>
where the box will be a cube of 8A, with the "lower" corner in x = 59, y = 31, z = 23, and the "higher" corner in x = 67, y = 39, z = 31 (all values in A). The -c flag specifies the base-name of the generated <code>.cmd</code> files; it has been applied in this example to avoid overwritting the previously generated <code>run_bnd.cmd</code> file.
</p>
<p>
<h5>Running JAWS speficying the number of waters</h5>
When protoms is run such in the initial example (first section in the tutorial), or in the example avobe, the default is chosen for the amount of water molecules to include inside the box. This can be modified with the flag <code>--gcmcwater</code>. The amount of waters included as JAWS probes can have an effect in the results of your simulation. Feel free to play around with this parameter. It can be specified as shown below </p>
<p><code>
python2.7 ~/ProtoMS3.0/protoms.py -l fragment.pdb -p protein.pdb -s jaws1 -c big --gcmcbox 59 31 23 8 8 8 --gcmcwater 10
</code></p>
<p>
<h5>Running longer simulations</h5>
There are two arguments that you can invoke to run a longer simulation
<ul>
	<li><code>--nequil</code> - this controls the number of equilibration steps</li>
	<li><code>--nprod</code> - this controls the number of production steps</li>
</ul>  
by typing for instance
<p>
<code>python2.7 $PROTOMSHOME/protoms.py -s jaws1 -p protein.pdb -l fragment.pdb --nequil 10E6 --nprod 50E6</code>
<p>
you will run 10 m equiliration steps and 50 m production steps (instead of the 5 m and 40 m that is default)
<p>
<h5>Running independent repeats</h5>
Usually it is wise to run several indepent repeats of your calculation to check for convergence. The argument that controls the number of independent repeats is called <code>--repeats</code> or just <code>-r</code>.
<p>
by typing for instance
<p>
<code>python2.7 $PROTOMSHOME/protoms.py -s jaws1 -p protein.pdb -l fragment.pdb -r 5</code>
<p>
you will create 5 input files for the JAWS calculation. Therefore, you also need to execute ProtoMS 5 times with the different input files. The output will be in 5 different folders, e.g. <code>out1_bnd</code> and <code>out2_bnd</code>.
<p>
<hr align="center"/>
<p> 
<h3><a name="files">Files created by the setup script</a></h3>
<h5>Files describing benzene</h5>
<ul>
	<li><code>benzene.prepi </code> = the z-matrix and atom types of benzene in Amber format</li>
	<li><code>benzene.frcmod </code> =  additional parameters not in GAFF</li>
	<li><code>benzene.zmat</code> = the z-matrix of benzene used to sample it in the MC simulation</li>
	<li><code>benzene.tem</code> = the complete template (force field) file for the ligand in ProtoMS format</li>
</ul>
You can read more about the setup of ligands here.
<h5>Files describing the protein</h5>
<ul>
	<li><code>protein_scoop.pdb</code> = the truncated protein structure</li>
</ul>
You can read more about the setup of proteins here.
<p> 
<h5>Simulation specific files</h5>
<ul>
	<li><code>benzene_box.pdb</code> = the box of water solvating benzene in the free leg simulation</li>
	<li><code>water.pdb</code> = the cap of water solvating the protein-ligand system in the bound leg simulation</li>
	<li><code>benzene_dummy.pdb</code> = the dummy particle that benzene will be perturbed into</li>
	<li><code>bnz-dummy.tem</code> = the combined template file for benzene and the dummy, used only in this simulation</li>
	<li><code>run_bnd.cmd</code> = the ProtoMS input file for the bound-leg simulation</li>
	<li><code>run_free.cmd</code> = the ProtoMS input file for the free-leg simulation</li>
</ul>
You can read more about the input files in the ProtoMS manual. However, some sections of it is worth mentioning here
<p>
<code>
dualtopology1 1 2 synctrans syncrot<br>
softcore1 solute 1<br>
softcore2 solute 2<br>
softcoreparams coul 1 delta 0.2 deltacoul 2.0 power 6 soft66 <br>
</code>
<br>
this section, which exist in both input files setup the dual topology simulation with appropriate soft-core parameters. It could be worth trying to optimize the soft-core parameters if your simulation is not performing well. 
<p>  
<code>
lambdare 200000 0.000 0.067 0.133 0.200 0.267 0.333 0.400 0.467 0.533 0.600 0.667 0.733 0.800 0.867 0.933 1.000<br>
</code>
<br>
this section, which exists in both input file setup the &lambda;-replica exchange. You can add more &lambda;-values manually if there are regions where the simulation is not performing well.
<p>
<code>
chunk id add 1 solute 1 C4 BNZ<br>
chunk restraint add 1 cartesian harmonic 27.837 6.921 3.569 10<br>
chunk id add 2 solute 2 C1 DDD<br>
chunk restraint add 2 cartesian harmonic 26.911 6.126 4.178 10<br>
</code> 
<br>
this section, which is unique for the bound-leg simulation, restrains the benzene and the dummy particle to the binding site with harmonic restraints. It could be worth trying to optimize the weight of the restraint or try another type of restraint if your simulation is not performing well.
<p>
<hr align="center"/>
<p> 
<h3><a name="tools">Setting up the simulation with individual tools</a></h3>
In this advanced section we will go through the setup of the simulations step-by-step using individual setup scripts rather than <code>protoms.py</code>
<h5>Setting up the free leg</h5>
We will start setting up the free-leg simulation. However, it should be noted that some of the files created in this section will also be used in the bound-leg simulation.
<p>
<li>First we need to make sure that the very first line of the <code>benzene.pdb</code> contains a directive, telling ProtoMS the name of the solute. The line should read <code>HEADER BNZ</code> and can be added by typing
<p>
<code>sed -i "1iHEADER BNZ" benzene.pdb</code>
<p>
<li>Thereafter, we will create the force field for the benzene molecule using AmberTools. The force field will be GAFF with AM1-BCC charge. Type
<p>
<code>$PROTOMSHOME/tools/ambertools.py -f benzene.pdb -n BNZ</code>
<P>
and this will execute the AmberTools programs <code>antechamber</code> and <code>parmchk</code>, creating the files <code>benzene.prepi</code> and <code>benzene.frcmod</code>, respectively. 
<p>
<li>These files are in Amber format and in order to use them in ProtoMS we need to reformat them into a ProtoMS template file. This file will also contain a z-matrix that describes how benzene will be sampled during the simulation. To do this, you can type
<p>
<code>$PROTOMSHOME/tools/build_template.py -p benzene.prepi -f benzene.frcmod -o benzene.tem -n BNZ</code>
<p>
this will creates the files <code>benzene.tem</code> containing the ProtoMS template file and <code>benzene.zmat</code>. It is a good idea to check this files to see if the script has defined the molecule properly.
<p>
<li>The next thing we will do is to solvate the benzene molecule in a box of TIP4P water molecules. Type
<p>
<code>$PROTOMSHOME/tools/solvate.py -b $PROTOMSHOME/data/wbox_tip4p.pdb -s benzene.pdb -o benzene_box.pdb</code>
<p> 
this will solvate benzene using standard settings, i.e. it will be 10 A between the solute and the edge of the box. A pre-equilibrated box of TIP4P water molecules located in <code>$PROTOMSHOME/data/</code> is used. The box is written to the file <code>benzene_box.pdb</code>.
<p> 
<li>Now we have setup benzene, but to complete the setup we need the dummy particle that benzene will be perturbed into. This is created by typing
<p> 
<code>$PROTOMSHOME/tools/make_dummy.py -f benzene.pdb -o benzene_dummy.pdb</code>
<p> 
creating <code>benzene_dummy.pdb that contains the particle.</code>
<p>
<li>Finally, we need to combine the template file of benzene with the template file of the dummy particle. Type
<p> 
<code>$PROTOMSHOME/tools/merge_templates.py -f benzene.tem $PROTOMSHOME/data/dummy.tem -o bnz-dummy.tem</code>
<p> 
creating <code>bnz-dummy.tem</code>. The template file of the dummy particle is located in <code>$PROTOMSHOME/data/</code>.
<p>
Now we have all the files to run the free-leg of the simulation. The input file for ProtoMS will be created when we have prepared to bound-leg.
<h5>Setting up the bound leg</h5>
<li>First, we will change the name of atom and residue names in the protein PDB-file such that they agree with the ProtoMS naming convention. Type
<p> 
<code>$PROTOMSHOME/tools/convertatomnames.py -p protein.pdb -o protein_pms.pdb -s amber -c $PROTOMSHOME/data/atomnamesmap.dat</code>
<p> 
The converted structure will be in <code>protein_pms.pdb</code>. This execution assumes that the Amber naming convention is used in <code>protein.pdb</code>. 
<p> 
<li>We have crystallographic water in the protein structure and we need to convert them to the water model we will be using in the simulation (TIP4P). This can be done by 
<p> 
<code>python2.7 $PROTOMSHOME/tools/convertwater.py -p protein_pms.pdb -o protein_pms_t4p.pdb</code>
<p>
creating <code>protein_pms_t4p.pdb</code>. 
<p>
<li>Next step is to truncate to protein, creating a scoop. This will enable us to solvate the protein is a droplet and thereby reducing the number of simulated particles. The command is
<p>
<code>$PROTOMSHOME/tools/scoop.py -p protein_pms_t4p.pdb -l benzene.pdb -o protein_scoop.pdb</code> 
<p> 
The protein scoop is centred on the benzene molecule and all residue further than 20 A are cut-away. The scoop is written to <code>protein_scoop.pdb</code>
<p>
<li>As a final step, we will solvate the protein and ligand in a droplet of TIP4P water molecules. To this, type:
<p> 
<code>$PROTOMSHOME/tools/solvate.py -b $PROTOMSHOME/data/wbox_tip4p.pdb -s benzene.pdb -pr protein_scoop.pdb -o water.pdb -g droplet</code> 
<p>
this will create a droplet with 30 A radius centred on the benzene molecule. The droplet is written to <code>water.pdb</code>
<p> 
<li> The <code>solvate.py</code> script adds the crystallographic waters from the scoop to the droplet. Therefore, we need to remove them from the scoop PDB-file.<p> 
<code>sed -i -e "/T4P/d" -e "/TER/d" protein_scoop.pdb</code>
<p>
Now we have all the files need to run the simulation. As you noticed, this step-by-step procedure create a few files that <code>protoms.py</code> does not generate.
<h5>Making ProtoMS input files</h5>
To make the input files for ProtoMS type
<p>
<code>$PROTOMSHOME/tools/generate_input.py -s dualtopology -p protein_scoop.pdb -l benzene.pdb benzene_dummy.pdb -t bnz-dummy.tem -pw water.pdb -lw benzene_box.pdb --absolute -o run</code>
<p> 
creating <code>run_bnd.cmd</code> and <code>run_free.cmd</code>.
<H3>References</H3>
<p>1. Michelle et.al. <i>J. Phys. Chem. B,</i> 2009, 113(40), pp 13337â€“13346</p>
<p>2.
</BODY>
</HTML>
